{% load static %}
{% load roles nav %}

<ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion" id="accordionSidebar">

  <!-- Brand -->
  <a class="sidebar-brand d-flex align-items-center justify-content-center" href="{% url 'dashboard' %}">
    <div class="sidebar-brand-icon text-center" style="padding: 20px 10px;">
      <img src="{% static 'img/basslogowhite.png' %}" 
           alt="BASS" 
           style="max-height:130px; width:auto; display:block; margin:auto;">
    </div>
  </a>

  <hr class="sidebar-divider my-0">

  <!-- Dashboard -->
  <li class="nav-item">
    <a class="nav-link {% if request.path == '/dashboard/' %}active{% endif %}" href="{% url 'dashboard' %}">
      <i class="fas fa-fw fa-tachometer-alt"></i> <span>Dashboard</span>
    </a>
  </li>

  <!-- OPERACIÓN -->
  {% if user|has_any_group:"admin,viajes,monitoreo" %}
  <hr class="sidebar-divider">
  <div class="sidebar-heading">Operación</div>

  {% if user|has_any_group:"admin,viajes" %}
  <li class="nav-item">
    <a class="nav-link {% if request.path|startswith:'/trips/' %}active{% endif %}" href="/trips/">
      <i class="fas fa-route"></i> <span>Viajes</span>
    </a>
  </li>
  {% endif %}

  {% if user|has_any_group:"admin,monitoreo" %}
  <li class="nav-item">
    <a class="nav-link {% if request.path|startswith:'/monitoring/' %}active{% endif %}" href="/monitoring/">
      <i class="fas fa-satellite-dish"></i> <span>Monitoreo</span>
    </a>
  </li>
  {% endif %}
  {% endif %}

  <!-- CATÁLOGOS -->
  {% if user|has_any_group:"admin,operadores,unidades,cat_catalogos" %}
  <hr class="sidebar-divider">
  <div class="sidebar-heading">Catálogos</div>

  <li class="nav-item">
    <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseCatalogos"
       aria-expanded="false" aria-controls="collapseCatalogos">
      <i class="fas fa-folder"></i>
      <span>Catálogos</span>
    </a>

    <div id="collapseCatalogos"
         class="collapse {% if request.path|startswith_any:'/clients/,/locations/,/packages/,/operators/,/trucks/' %}show{% endif %}"
         data-parent="#accordionSidebar">
      <div class="bg-white py-2 collapse-inner rounded">

        <!-- Clientes -->
        <a class="collapse-item {% if request.path|startswith:'/clients/' %}active{% endif %}" href="/clients/">
          <i class="fas fa-address-book mr-2"></i> Clientes
        </a>

        <!-- Ubicaciones -->
        <a class="collapse-item {% if request.path|startswith:'/locations/' %}active{% endif %}" href="/locations/">
          <i class="fas fa-map-marker-alt mr-2"></i> Ubicaciones
        </a>

        <!-- Empaques -->
        <a class="collapse-item {% if request.path|startswith:'/packages/' %}active{% endif %}" href="/packages/">
          <i class="fas fa-box-open mr-2"></i> Empaques
        </a>

        <!-- Operadores -->
        {% if user|has_any_group:"admin,operadores" %}
        <a class="collapse-item {% if request.path|startswith:'/operators/' %}active{% endif %}" href="/operators/">
          <i class="fas fa-user mr-2"></i> Operadores
        </a>
        {% endif %}

        <!-- Unidades -->
        {% if user|has_any_group:"admin,unidades" %}
        <a class="collapse-item {% if request.path|startswith:'/trucks/' %}active{% endif %}" href="/trucks/">
          <i class="fas fa-truck mr-2"></i> Unidades
        </a>
        {% endif %}
      </div>
    </div>
  </li>
  {% endif %}

  <!-- ADMINISTRACIÓN -->
  {% if user|has_any_group:"admin,liquidacion,cobranza,financiero" %}
  <hr class="sidebar-divider">
  <div class="sidebar-heading">Administración</div>

  {% if user|has_any_group:"admin,liquidacion" %}
  <li class="nav-item">
    <a class="nav-link {% if request.path|startswith:'/settlement/' %}active{% endif %}" href="/settlement/">
      <i class="fas fa-file-invoice-dollar"></i> <span>Liquidación</span>
    </a>
  </li>
  {% endif %}

  {% if user|has_any_group:"admin,cobranza" %}
  <li class="nav-item">
    <a class="nav-link {% if request.path|startswith:'/collection/' %}active{% endif %}" href="/collection/">
      <i class="fas fa-hand-holding-usd"></i> <span>Cobranza</span>
    </a>
  </li>
  {% endif %}

  {% if user|has_any_group:"admin,financiero" %}
  <li class="nav-item">
    <a class="nav-link {% if request.path|startswith:'/finance/' %}active{% endif %}" href="/finance/">
      <i class="fas fa-coins"></i> <span>Financiero</span>
    </a>
  </li>
  {% endif %}
  {% endif %}

  <!-- CUMPLIMIENTO -->
  {% if user|has_any_group:"admin,ctpat" %}
  <hr class="sidebar-divider">
  <div class="sidebar-heading">Cumplimiento</div>
  <li class="nav-item">
    <a class="nav-link {% if request.path|startswith:'/ctpat/' %}active{% endif %}" href="/ctpat/">
      <i class="fas fa-shield-alt"></i> <span>CTPAT</span>
    </a>
  </li>
  {% endif %}

  <!-- SISTEMA -->
  {% if user|has_group:"admin" %}
  <hr class="sidebar-divider">
  <div class="sidebar-heading">Sistema</div>
  <li class="nav-item">
    <a class="nav-link {% if request.path|startswith:'/admin/' %}active{% endif %}" href="/admin/">
      <i class="fas fa-users-cog"></i> <span>Cuentas</span>
    </a>
  </li>
  <li class="nav-item">
    <a class="nav-link {% if request.path|startswith:'/audit/' %}active{% endif %}" href="/audit/">
      <i class="fas fa-lock"></i> <span>Bitácora</span>
    </a>
  </li>
  {% endif %}

  <hr class="sidebar-divider d-none d-md-block">

  <!-- LOGOUT -->
  <li class="nav-item px-3 pb-3">
    <form action="{% url 'logout' %}" method="post" class="m-0 p-0">
      {% csrf_token %}
      <button type="submit" class="btn btn-light btn-sm w-100">
        <i class="fas fa-sign-out-alt"></i> Salir
      </button>
    </form>
  </li>
</ul>
