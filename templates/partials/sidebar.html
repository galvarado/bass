{% load static %}
{% load roles %}

<ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion" id="accordionSidebar">

  {# ========================================================= #}
  {#  BRAND: operador -> mis viajes, normal -> dashboard        #}
  {# ========================================================= #}
  <a class="sidebar-brand d-flex align-items-center justify-content-center"
     href="{% if user|has_group:"operador" and not user|has_group:"admin" and not user|has_group:"superadmin" %}{% url 'trips:my_list' %}{% else %}{% url 'dashboard' %}{% endif %}">
    <div class="sidebar-brand-icon text-center" style="padding: 20px 10px;">
      <img src="{% static 'img/basslogowhite.png' %}"
           alt="BASS"
           style="max-height:130px; width:auto; display:block; margin:auto;">
    </div>
  </a>

  <hr class="sidebar-divider my-0">

  {# ========================================================= #}
  {#  OPERADOR: SOLO MIS VIAJES                                 #}
  {# ========================================================= #}
  {% if user|has_group:"operador" and not user|has_group:"admin" and not user|has_group:"superadmin" %}

    <div class="sidebar-heading text-uppercase">Operación</div>

    <li class="nav-item">
      <a class="nav-link {% if '/trips/mis-viajes' in request.path %}active{% endif %}"
         href="{% url 'trips:my_list' %}">
        <i class="fas fa-route"></i> <span>Mis viajes</span>
      </a>
    </li>

  {% else %}

    {# ========================================================= #}
    {#  NORMAL: DASHBOARD + SECCIONES SEGÚN GRUPO                 #}
    {# ========================================================= #}

    <!-- Dashboard -->
    <li class="nav-item">
      <a class="nav-link {% if request.path == '/dashboard/' %}active{% endif %}" href="{% url 'dashboard' %}">
        <i class="fas fa-fw fa-tachometer-alt"></i> <span>Dashboard</span>
      </a>
    </li>

    <hr class="sidebar-divider">

    {# ======================= OPERACIÓN ======================= #}
    {% with section="operacion" %}
      {% if user|has_group:"superadmin" or user|has_group:"admin" or user|has_group:section %}
        <div class="sidebar-heading text-uppercase">Operación</div>

        <li class="nav-item">
          <a class="nav-link {% if '/trips/' in request.path and not '/trips/board' in request.path %}active{% endif %}"
             href="{% url 'trips:list' %}">
            <i class="fas fa-route"></i> <span>Viajes</span>
          </a>
        </li>

        <li class="nav-item">
          <a class="nav-link {% if '/trips/board' in request.path %}active{% endif %}"
             href="{% url 'trips:board' %}">
            <i class="fas fa-satellite-dish"></i> <span>Monitoreo</span>
          </a>
        </li>

        <hr class="sidebar-divider">
      {% endif %}
    {% endwith %}

    {# ======================= FINANZAS ======================== #}
    {% with section="finanzas" %}
      {% if user|has_group:"superadmin" or user|has_group:"admin" or user|has_group:section %}
        <div class="sidebar-heading text-uppercase">Finanzas</div>

        <li class="nav-item">
          <a class="nav-link {% if '/finanzas/liquidacion' in request.path %}active{% endif %}"
             href="">
            <i class="fas fa-hand-holding-usd"></i> <span>Liquidación</span>
          </a>
        </li>

        <li class="nav-item">
          <a class="nav-link {% if '/finanzas/cobranza' in request.path %}active{% endif %}"
             href="">
            <i class="fas fa-file-invoice-dollar"></i> <span>Cobranza</span>
          </a>
        </li>

        <hr class="sidebar-divider">
      {% endif %}
    {% endwith %}

    {# ======================= CATÁLOGOS ======================= #}
    {% with section="catalogos" %}
      {% if user|has_group:"superadmin" or user|has_group:"admin" or user|has_group:section %}
        <div class="sidebar-heading text-uppercase">Catálogos</div>

        <li class="nav-item">
          <a class="nav-link collapsed"
             href="#"
             data-toggle="collapse"
             data-target="#collapseCatalogs"
             aria-expanded="false"
             aria-controls="collapseCatalogs">
            <i class="fas fa-list"></i>
            <span>Catálogos</span>
          </a>

          <div id="collapseCatalogs" class="collapse" aria-labelledby="headingCatalogs">
            <div class="bg-white py-2 collapse-inner rounded">
              <a class="collapse-item {% if '/customers' in request.path %}active{% endif %}" href="{% url 'customers:list' %}">
                <i class="fas fa-building mr-2 text-muted"></i> Clientes
              </a>
              <a class="collapse-item {% if '/locations' in request.path %}active{% endif %}" href="{% url 'locations:list' %}">
                <i class="fas fa-location-dot mr-2 text-muted"></i> Rutas
              </a>
              <a class="collapse-item {% if '/operators' in request.path %}active{% endif %}" href="{% url 'operators:list' %}">
                <i class="fas fa-user mr-2 text-muted"></i> Operadores
              </a>
              <a class="collapse-item {% if '/trucks' in request.path %}active{% endif %}" href="{% url 'trucks:list' %}">
                <i class="fas fa-truck mr-2 text-muted"></i> Vehículos
              </a>
              <a class="collapse-item {% if '/suppliers' in request.path %}active{% endif %}" href="{% url 'suppliers:list' %}">
                <i class="fas fa-id-card mr-2 text-muted"></i> Proveedores
              </a>
            </div>
          </div>
        </li>

        <hr class="sidebar-divider">
      {% endif %}
    {% endwith %}

    {# ========================= TALLER ======================== #}
    {% if user|has_group:"superadmin" or user|has_group:"admin" or user|has_group:"taller" %}
      <div class="sidebar-heading text-uppercase">Taller</div>

      <li class="nav-item">
        <a class="nav-link {% if '/workshop/' in request.path %}active{% endif %}"
           href="{% url 'workshop:list' %}">
          <i class="fas fa-tools"></i> <span>Órdenes de taller</span>
        </a>
      </li>

      <hr class="sidebar-divider">
    {% endif %}

    {# ========================= ALMACÉN ======================= #}
    {% if user|has_group:"superadmin" or user|has_group:"admin" or user|has_group:"almacen" %}
      <div class="sidebar-heading text-uppercase">Almacén</div>

      <li class="nav-item">
        <a class="nav-link {% if '/warehouse/' in request.path %}active{% endif %}"
           href="{% url 'warehouse:sparepart_list' %}">
          <i class="fas fa-warehouse"></i> <span>Inventario</span>
        </a>
      </li>

      <hr class="sidebar-divider">
    {% endif %}

    {# ====================== CUMPLIMIENTO ===================== #}
    {% with section="cumplimiento" %}
      {% if user|has_group:"superadmin" or user|has_group:"admin" or user|has_group:section %}
        <div class="sidebar-heading text-uppercase">Cumplimiento</div>

        <li class="nav-item">
          <a class="nav-link {% if '/ctpat' in request.path %}active{% endif %}"
             href="">
            <i class="fas fa-shield"></i> <span>CTPAT</span>
          </a>
        </li>

        <hr class="sidebar-divider">
      {% endif %}
    {% endwith %}

    {# ========================= SISTEMA ======================= #}
    {% if user|has_group:"superadmin" or user|has_group:"admin" %}
      <div class="sidebar-heading text-uppercase">Sistema</div>

      <li class="nav-item">
        <a class="nav-link {% if '/accounts/' in request.path and not '/accounts/roles' in request.path %}active{% endif %}"
           href="{% url 'accounts:list' %}">
          <i class="fas fa-user-circle"></i> <span>Usuarios</span>
        </a>
      </li>

      <li class="nav-item">
        <a class="nav-link {% if '/accounts/roles' in request.path %}active{% endif %}"
           href="{% url 'accounts:roles' %}">
          <i class="fas fa-address-card"></i> <span>Roles</span>
        </a>
      </li>

      {# BITÁCORA: SOLO SUPERADMIN #}
      {% if user|has_group:"superadmin" %}
        <li class="nav-item">
          <a class="nav-link {% if '/audit/' in request.path %}active{% endif %}"
             href="{% url 'audit:list' %}">
            <i class="fas fa-book"></i> <span>Bitácora</span>
          </a>
        </li>
      {% endif %}

      <hr class="sidebar-divider">
    {% endif %}

  {% endif %}

</ul>
