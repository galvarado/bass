{% extends "base.html" %}
{% block title %}Detalle de Camión · BASS{% endblock %}
{% block content %}

<div class="card shadow-sm">
  <div class="card-header d-flex justify-content-between align-items-center">
    <strong>Detalle de Camión</strong>
    <div>
      <a href="{% url 'trucks:update' truck.pk %}" class="btn btn-sm btn-outline-secondary">
        <i class="fas fa-edit"></i> Editar
      </a>
      <a href="{% url 'trucks:delete' truck.pk %}" class="btn btn-sm btn-outline-danger">
        <i class="fas fa-trash"></i> Eliminar
      </a>
    </div>
  </div>

  <div class="card-body">

    <!-- ===== DATOS GENERALES ===== -->
    <h6 class="text-primary mb-3"><i class="fas fa-truck mr-1"></i> Datos generales</h6>
    <dl class="row small">
      <dt class="col-sm-3">Número económico</dt><dd class="col-sm-9">{{ truck.numero_economico|default:"—" }}</dd>
      <dt class="col-sm-3">Placas</dt><dd class="col-sm-9">{{ truck.placas|default:"—" }}</dd>
      <dt class="col-sm-3">Serie (VIN)</dt><dd class="col-sm-9">{{ truck.serie|default:"—" }}</dd>
      <dt class="col-sm-3">Marca</dt><dd class="col-sm-9">{{ truck.marca|default:"—" }}</dd>
      <dt class="col-sm-3">Categoría</dt><dd class="col-sm-9">{{ truck.categoria|default:"—" }}</dd>
      <dt class="col-sm-3">Rin</dt><dd class="col-sm-9">{{ truck.rin|default:"—" }}</dd>
    </dl>

    <hr>

    <!-- ===== ESPECIFICACIONES ===== -->
    <h6 class="text-primary mb-3"><i class="fas fa-cogs mr-1"></i> Especificaciones</h6>
    <dl class="row small">
      <dt class="col-sm-3">Motor</dt><dd class="col-sm-9">{{ truck.motor|default:"—" }}</dd>
      <dt class="col-sm-3">Combustible</dt><dd class="col-sm-9">{{ truck.combustible|default:"—" }}</dd>
      <dt class="col-sm-3">Capacidad de combustible</dt>
      <dd class="col-sm-9">
        {% if truck.capacidad_combustible %}
          {{ truck.capacidad_combustible }} L
        {% else %}—{% endif %}
      </dd>
      <dt class="col-sm-3">Peso bruto</dt>
      <dd class="col-sm-9">
        {% if truck.peso_bruto %}
          {{ truck.peso_bruto }} kg
        {% else %}—{% endif %}
      </dd>
      <dt class="col-sm-3">Ciclo de mantenimiento</dt><dd class="col-sm-9">{{ truck.ciclo_mtto|default:"—" }}</dd>
    </dl>

    <hr>

    <!-- ===== DOCUMENTOS ===== -->
    <h6 class="text-primary mb-3"><i class="fas fa-file-alt mr-1"></i> Documentos</h6>
    <dl class="row small">
      <dt class="col-sm-3">Póliza de seguro</dt><dd class="col-sm-9">{{ truck.seguro|default:"—" }}</dd>
      <dt class="col-sm-3">Tarjeta de circulación</dt><dd class="col-sm-9">{{ truck.tarjeta_circulacion|default:"—" }}</dd>
    </dl>

  </div>
</div>

<!-- ==========================
     HISTORIAL DE ORDENES TALLER
=========================== -->
<div class="card shadow-sm mt-4">
  <div class="card-header d-flex justify-content-between align-items-center">
    <strong><i class="fas fa-tools mr-1"></i> Historial de órdenes de taller</strong>
  </div>

  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-hover table-sm mb-0">
        <thead class="thead-light">
          <tr class="small">
            <th>Folio</th>
            <th>Descripción</th>
            <th>Estado</th>
            <th>Fecha entrada</th>
            <th>Salida estimada</th>
            <th>Salida real</th>
          </tr>
        </thead>
        <tbody>
          {% for ot in orders_workshop %}
          <tr class="small">
            <td>
              <a href="{% url 'workshop:detail' ot.pk %}">
                {{ ot.folio_interno }}
              </a>
            </td>

            <td>
              {% if ot.descripcion %}
                {{ ot.descripcion|truncatechars:60 }}
              {% else %}
                <span class="text-muted">Sin descripción</span>
              {% endif %}
            </td>

            <td>
              {% if ot.estado == "ABIERTA" %}
                <span class="badge badge-warning">Abierta</span>
              {% elif ot.estado == "REPARACION" %}
                <span class="badge badge-primary">En reparación</span>
              {% elif ot.estado == "ESPERA_REFACCION" %}
                <span class="badge badge-info">Espera refacción</span>
              {% elif ot.estado == "TERMINADA" %}
                <span class="badge badge-success">Terminada</span>
              {% elif ot.estado == "CANCELADA" %}
                <span class="badge badge-danger">Cancelada</span>
              {% else %}
                <span class="badge badge-secondary">—</span>
              {% endif %}
            </td>

            <td>
              {% if ot.fecha_entrada %}
                {{ ot.fecha_entrada|date:"d/m/Y H:i" }}
              {% else %}
                <span class="text-muted">—</span>
              {% endif %}
            </td>

            <td>
              {% if ot.fecha_salida_estimada %}
                {{ ot.fecha_salida_estimada|date:"d/m/Y" }}
              {% else %}
                <span class="text-muted">Sin estimar</span>
              {% endif %}
            </td>

            <td>
              {% if ot.fecha_salida_real %}
                {{ ot.fecha_salida_real|date:"d/m/Y H:i" }}
              {% else %}
                <span class="text-muted">—</span>
              {% endif %}
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="6" class="text-center text-muted py-3 small">
              Este camión no tiene órdenes de taller registradas.
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

{% endblock %}
